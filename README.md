# üìà Trading Bot - –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –Ω–∞ MOEX

**‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞ –±–∏—Ä–∂–µ –Ω–µ—Å—ë—Ç —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –∫–∞–ø–∏—Ç–∞–ª–∞. –ë–æ—Ç ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Ö–æ–¥–∞.**

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç

| –í—Ä–µ–º—è | –î–µ–π—Å—Ç–≤–∏–µ |
|-------|----------|
| 06:30 –ú–°–ö | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ |
| | ‚Üí –ü–æ–∏—Å–∫ –ª–∏–∫–≤–∏–¥–Ω—ã—Ö –∞–∫—Ü–∏–π (–æ–±–æ—Ä–æ—Ç > 50–ú ‚ÇΩ) |
| | ‚Üí –†–∞—Å—á—ë—Ç ATR14 –ø–æ —á–∞—Å–∞–º 10-19 –ú–°–ö |
| | ‚Üí –†–∞—Å—á—ë—Ç Bollinger Bands (20, 2œÉ) |
| | ‚Üí –†–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–∑–∏—Ü–∏–π —Å —É—á—ë—Ç–æ–º —Ä–∏—Å–∫–∞ |
| | ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–∞ –≤ Telegram |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
trading_bot/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ config.yaml            # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tinkoff_client.py    # Tinkoff API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_notifier.py # Telegram
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stream_manager.py    # –°—Ç—Ä–∏–º—ã (TODO)
‚îÇ   ‚îú‚îÄ‚îÄ indicators/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ atr.py         # ATR —Ä–∞—Å—á—ë—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bollinger.py   # Bollinger Bands
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py       # –§–∏–ª—å—Ç—Ä –ø–æ —á–∞—Å–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ strategy/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py        # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bollinger_bounce.py  # –û—Ç—Å–∫–æ–∫ –æ—Ç BB
‚îÇ   ‚îú‚îÄ‚îÄ risk/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ position_sizer.py    # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ executor/          # (TODO)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order_manager.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ position_tracker.py
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jobs.py        # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îú‚îÄ‚îÄ models.py      # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ       ‚îî‚îÄ‚îÄ repository.py  # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ tests/
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è: Bollinger Bounce

```
–í—Ö–æ–¥:  –¶–µ–Ω–∞ ‚â§ –Ω–∏–∂–Ω–µ–≥–æ –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞ + 1%
–í—ã—Ö–æ–¥: +0.5 ATR (profit) –∏–ª–∏ -0.3 ATR (stop)

–ú–∞—Ç. –æ–∂–∏–¥–∞–Ω–∏–µ:
- Risk:Reward = 1 : 1.67
- –î–ª—è –±–µ–∑—É–±—ã—Ç–∫–∞ –Ω—É–∂–µ–Ω WinRate > 37.5%
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω Tinkoff API

1. –û—Ç–∫—Ä–æ–π https://www.tinkoff.ru/invest/settings/api/
2. –°–æ–∑–¥–∞–π —Ç–æ–∫–µ–Ω (–¥–ª—è MVP –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ "–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ")
3. –°–∫–æ–ø–∏—Ä—É–π —Ç–æ–∫–µ–Ω

### 2. –ù–∞—Å—Ç—Ä–æ–π .env

```bash
cp .env.example .env
nano .env
```

```env
TINKOFF_TOKEN=—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
TELEGRAM_BOT_TOKEN=—Ç–≤–æ–π_–±–æ—Ç_—Ç–æ–∫–µ–Ω
TELEGRAM_CHAT_ID=—Ç–≤–æ–π_chat_id
POSTGRES_PASSWORD=–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–ø–∞—Ä–æ–ª—å
DEPOSIT_RUB=1000000
```

### 3. –ó–∞–ø—É—Å—Ç–∏

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d

# –õ–æ–≥–∏
docker-compose logs -f bot

# –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç (–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è 06:30)
docker-compose run --rm bot python main.py --now

# –û–¥–∏–Ω —Ä–∞—Å—á—ë—Ç –∏ –≤—ã—Ö–æ–¥
docker-compose run --rm bot python main.py --now --once
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.yaml)

```yaml
# –°—Ç—Ä–∞—Ç–µ–≥–∏—è Bollinger Bounce
strategy:
  bollinger_bounce:
    enabled: true
    bollinger_period: 20
    bollinger_std: 2.0
    entry_threshold_pct: 1.0    # –í—Ö–æ–¥ –µ—Å–ª–∏ —Ü–µ–Ω–∞ < BB_lower + 1%

# –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
risk:
  stop_loss_atr: 0.3            # –°—Ç–æ–ø = 0.3 √ó ATR
  take_profit_atr: 0.5          # –¢–µ–π–∫ = 0.5 √ó ATR
  max_position_pct: 0.25        # –ú–∞–∫—Å 25% –¥–µ–ø–æ–∑–∏—Ç–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é
  max_open_positions: 3

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
safety:
  dry_run: true                 # true = –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
```

## –ü—Ä–∏–º–µ—Ä –æ—Ç—á—ë—Ç–∞ –≤ Telegram

```
üìä –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ä–∞—Å—á—ë—Ç
üìÖ 2024-12-20 06:30 –ú–°–ö
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üîç –õ–∏–∫–≤–∏–¥–Ω—ã—Ö –∞–∫—Ü–∏–π: 15
üí∞ –î–µ–ø–æ–∑–∏—Ç: 1,000,000 ‚ÇΩ
‚ö†Ô∏è –†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: 1%

üìà –¢–û–ü –∞–∫—Ü–∏–∏:

üü¢ SBER                    ‚Üê —Å–∏–≥–Ω–∞–ª BUY
   üíµ –¶–µ–Ω–∞: 280 ‚ÇΩ
   üìä ATR: 4.20 (1.5%)
   üìâ BB –Ω–∏–∂–Ω—è—è: 275 ‚ÇΩ
   üì¶ –ü–æ–∑–∏—Ü–∏—è: 100 —à—Ç (28,000 ‚ÇΩ)
   üõë –°—Ç–æ–ø: 1.26 ‚ÇΩ | –£–±—ã—Ç–æ–∫: 126 ‚ÇΩ
   üìè –î–æ BB: 1.8%

‚ö™ YDEX
   üíµ –¶–µ–Ω–∞: 4,400 ‚ÇΩ
   üìä ATR: 60.00 (1.4%)
   ...

üíµ –§—å—é—á–µ—Ä—Å Si:
   –¢–∏–∫–µ—Ä: SiH5
   –¶–µ–Ω–∞: 103,500
   ATR: 420
   BB –Ω–∏–∂–Ω—è—è: 102,800

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ö†Ô∏è –¢–æ—Ä–≥–æ–≤–ª—è –Ω–µ—Å—ë—Ç —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –∫–∞–ø–∏—Ç–∞–ª–∞
ü§ñ dry_run: True
```

## –ö–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
docker-compose restart bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker-compose up -d --build

# –î–æ—Å—Ç—É–ø –∫ –ë–î (Adminer)
docker-compose --profile tools up -d
# –û—Ç–∫—Ä–æ–π http://localhost:8080
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (TODO)

- [ ] **executor/order_manager.py** ‚Äî –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫
- [ ] **executor/position_tracker.py** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- [ ] **api/stream_manager.py** ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å—Ç—Ä–∏–º—ã —Ü–µ–Ω
- [ ] **strategy/ema_crossover.py** ‚Äî —Ç—Ä–µ–Ω–¥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- [ ] **Trailing stop** ‚Äî –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–ø–∞
- [ ] **–ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏
- [ ] **Web UI** ‚Äî –¥–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT. –ò—Å–ø–æ–ª—å–∑—É–π –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫.
